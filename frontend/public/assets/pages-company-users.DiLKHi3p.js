import{b as e,s,d as l,w as a,i as t,o,e as r,f as i,h as d,j as n,x as u,t as c,S as m,k as f,F as h,l as _,q as p,p as g,I as C,m as F}from"./index-BJtJjslE.js";import{u as U,a as k,_ as b}from"./_plugin-vue_export-helper.CmGny4PI.js";const M=b({name:"UsersPage",data:()=>({users:[],showUserModal:!1,isEditMode:!1,userForm:{id:null,username:"",password:"",role:"user"},selectedRoleIndex:0,roleFilterOptions:["å…¨éƒ¨è§’è‰²","èµ„æºåè°ƒ","æŠ€æœ¯ç»ç†","é¡¾é—®","æ™®é€šç”¨æˆ·"],roleOptions:[{label:"èµ„æºåè°ƒ",value:"resource_coordinator",icon:"ğŸ‘‘"},{label:"æŠ€æœ¯ç»ç†",value:"tech_manager",icon:"ğŸ’¼"},{label:"é¡¾é—®",value:"consultant",icon:"ğŸ“"},{label:"æ™®é€šç”¨æˆ·",value:"user",icon:"ğŸ‘¤"}],filterRole:"",isLoading:!1,userColors:["#6FCF97","#F2994A","#BB6BD9","#56CCF2","#EB5757"]}),computed:{filteredUsers(){return this.filterRole?this.users.filter(e=>e.role===this.filterRole):this.users}},mounted(){this.loadUsers()},methods:{loadUsers(){U.getAll().then(e=>{e.success&&e.data&&(this.users=e.data)}).catch(s=>{console.error("åŠ è½½äººå‘˜åˆ—è¡¨å¤±è´¥:",s),e({title:"åŠ è½½å¤±è´¥",icon:"none"})})},onRoleFilterChange(e){this.selectedRoleIndex=e.detail.value;this.filterRole={0:"",1:"resource_coordinator",2:"tech_manager",3:"consultant",4:"user"}[this.selectedRoleIndex]},showCreateUserModal(){this.isEditMode=!1,this.userForm={id:null,username:"",password:"",role:"user"},this.showUserModal=!0},editUser(e){this.isEditMode=!0,this.userForm={id:e.id||null,username:e.username,password:"",role:e.role},this.showUserModal=!0},deleteUser(l){s({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤ç”¨æˆ·"${l.username}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`,success:s=>{s.confirm&&l.id&&U.delete(l.id).then(s=>{s.success?(e({title:"åˆ é™¤æˆåŠŸ",icon:"success"}),this.loadUsers()):e({title:s.message||"åˆ é™¤å¤±è´¥",icon:"none"})}).catch(s=>{console.error("åˆ é™¤ç”¨æˆ·å¤±è´¥:",s),e({title:"åˆ é™¤å¤±è´¥",icon:"none"})})}})},selectRole(e){this.userForm.role=e},handleModalOverlayClick(){this.closeUserModal()},closeUserModal(){this.showUserModal=!1},submitUserForm(){if(!this.userForm.username.trim())return void e({title:"è¯·è¾“å…¥ç”¨æˆ·å",icon:"none"});if(this.userForm.username.trim().length<3)return void e({title:"ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦",icon:"none"});if(!this.isEditMode&&(!this.userForm.password||this.userForm.password.length<6))return void e({title:"å¯†ç è‡³å°‘6ä½",icon:"none"});this.isLoading=!0;const s={username:this.userForm.username.trim(),role:this.userForm.role};this.userForm.password&&(s.password=this.userForm.password);(this.isEditMode&&this.userForm.id?U.update(this.userForm.id,s):k.register(s)).then(s=>{this.isLoading=!1,s.success?(e({title:this.isEditMode?"æ›´æ–°æˆåŠŸ":"æ·»åŠ æˆåŠŸ",icon:"success"}),this.closeUserModal(),this.loadUsers()):e({title:s.message||"æ“ä½œå¤±è´¥",icon:"none"})}).catch(s=>{this.isLoading=!1,console.error("æäº¤ç”¨æˆ·ä¿¡æ¯å¤±è´¥:",s),e({title:"æ“ä½œå¤±è´¥",icon:"none"})})},getRoleLabel:e=>({resource_coordinator:"èµ„æºåè°ƒ",tech_manager:"æŠ€æœ¯ç»ç†",consultant:"é¡¾é—®",user:"æ™®é€šç”¨æˆ·"}[e]||e),getUserColor(e){return e?this.userColors[e%this.userColors.length]:this.userColors[0]},formatDate(e){if(!e)return"";const s=new Date(e);return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`}}},[["render",function(e,s,U,k,b,M){const w=d,v=t,y=u,R=m,x=C;return o(),l(v,{class:"users-page"},{default:a(()=>[r(v,{class:"page-header"},{default:a(()=>[r(w,{class:"page-title"},{default:a(()=>[n("äººå‘˜ç®¡ç†")]),_:1}),r(v,{class:"header-actions"},{default:a(()=>[r(v,{class:"action-button",onClick:M.showCreateUserModal},{default:a(()=>[r(w,{class:"action-icon"},{default:a(()=>[n("+")]),_:1}),r(w,{class:"action-text"},{default:a(()=>[n("æ·»åŠ äººå‘˜")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1}),r(v,{class:"filter-section"},{default:a(()=>[r(v,{class:"filter-item"},{default:a(()=>[r(y,{range:b.roleFilterOptions,value:b.selectedRoleIndex,onChange:M.onRoleFilterChange},{default:a(()=>[r(v,{class:"picker-input"},{default:a(()=>[r(w,null,{default:a(()=>[n(c(b.roleFilterOptions[b.selectedRoleIndex]),1)]),_:1}),r(w,{class:"arrow"},{default:a(()=>[n("â–¼")]),_:1})]),_:1})]),_:1},8,["range","value","onChange"])]),_:1})]),_:1}),r(R,{class:"users-list","scroll-y":""},{default:a(()=>[(o(!0),f(h,null,_(M.filteredUsers,e=>(o(),l(v,{class:"user-card",key:e.id},{default:a(()=>[r(v,{class:"user-header"},{default:a(()=>[r(v,{class:"user-avatar",style:p({backgroundColor:M.getUserColor(e.id)})},{default:a(()=>[r(w,{class:"avatar-text"},{default:a(()=>[n(c(e.username.charAt(0).toUpperCase()),1)]),_:2},1024)]),_:2},1032,["style"]),r(v,{class:"user-info"},{default:a(()=>[r(w,{class:"user-name"},{default:a(()=>[n(c(e.username),1)]),_:2},1024),r(w,{class:"user-role"},{default:a(()=>[n(c(M.getRoleLabel(e.role)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),r(v,{class:"user-meta"},{default:a(()=>[r(w,{class:"meta-item"},{default:a(()=>[n("åˆ›å»ºæ—¶é—´ï¼š"+c(M.formatDate(e.created_at)),1)]),_:2},1024)]),_:2},1024),r(v,{class:"user-actions"},{default:a(()=>[r(v,{class:"action-btn edit",onClick:s=>M.editUser(e)},{default:a(()=>[n("ç¼–è¾‘")]),_:2},1032,["onClick"]),r(v,{class:"action-btn delete",onClick:s=>M.deleteUser(e)},{default:a(()=>[n("åˆ é™¤")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),0===M.filteredUsers.length?(o(),l(v,{key:0,class:"empty-state"},{default:a(()=>[r(w,{class:"empty-icon"},{default:a(()=>[n("ğŸ‘¥")]),_:1}),r(w,{class:"empty-text"},{default:a(()=>[n("æš‚æ— äººå‘˜")]),_:1}),r(w,{class:"empty-tip"},{default:a(()=>[n("ç‚¹å‡»å³ä¸Šè§’æŒ‰é’®æ·»åŠ æ–°äººå‘˜")]),_:1})]),_:1})):i("",!0)]),_:1}),b.showUserModal?(o(),l(v,{key:0,class:"user-modal-overlay",onClick:M.handleModalOverlayClick},{default:a(()=>[r(v,{class:"user-modal-container",onClick:s[3]||(s[3]=g(()=>{},["stop"]))},{default:a(()=>[r(v,{class:"modal-header"},{default:a(()=>[r(w,{class:"modal-title"},{default:a(()=>[n(c(b.isEditMode?"ç¼–è¾‘äººå‘˜":"æ·»åŠ äººå‘˜"),1)]),_:1}),r(v,{class:"close-btn",onClick:M.closeUserModal},{default:a(()=>[n("âœ•")]),_:1},8,["onClick"])]),_:1}),r(v,{class:"modal-content"},{default:a(()=>[r(v,{class:"form-group"},{default:a(()=>[r(w,{class:"form-label"},{default:a(()=>[n("ç”¨æˆ·å")]),_:1}),r(x,{class:"form-input",type:"text",modelValue:b.userForm.username,"onUpdate:modelValue":s[0]||(s[0]=e=>b.userForm.username=e),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å",disabled:b.isEditMode},null,8,["modelValue","disabled"])]),_:1}),b.isEditMode?i("",!0):(o(),l(v,{key:0,class:"form-group"},{default:a(()=>[r(w,{class:"form-label"},{default:a(()=>[n("å¯†ç ")]),_:1}),r(x,{class:"form-input",type:"password",modelValue:b.userForm.password,"onUpdate:modelValue":s[1]||(s[1]=e=>b.userForm.password=e),placeholder:"è¯·è¾“å…¥å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰"},null,8,["modelValue"])]),_:1})),b.isEditMode?(o(),l(v,{key:1,class:"form-group"},{default:a(()=>[r(w,{class:"form-label"},{default:a(()=>[n("æ–°å¯†ç ï¼ˆç•™ç©ºåˆ™ä¸ä¿®æ”¹ï¼‰")]),_:1}),r(x,{class:"form-input",type:"password",modelValue:b.userForm.password,"onUpdate:modelValue":s[2]||(s[2]=e=>b.userForm.password=e),placeholder:"è¯·è¾“å…¥æ–°å¯†ç "},null,8,["modelValue"])]),_:1})):i("",!0),r(v,{class:"form-group"},{default:a(()=>[r(w,{class:"form-label"},{default:a(()=>[n("è§’è‰²")]),_:1}),r(v,{class:"role-selector"},{default:a(()=>[(o(!0),f(h,null,_(b.roleOptions,(e,s)=>(o(),l(v,{class:F(["role-option",{active:b.userForm.role===e.value}]),key:e.value,onClick:s=>M.selectRole(e.value)},{default:a(()=>[r(w,{class:"role-icon"},{default:a(()=>[n(c(e.icon),1)]),_:2},1024),r(w,{class:"role-label"},{default:a(()=>[n(c(e.label),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1}),r(v,{class:"modal-actions"},{default:a(()=>[r(v,{class:"btn btn-cancel",onClick:M.closeUserModal},{default:a(()=>[n("å–æ¶ˆ")]),_:1},8,["onClick"]),r(v,{class:"btn btn-submit",onClick:M.submitUserForm},{default:a(()=>[n("ç¡®å®š")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])):i("",!0)]),_:1})}],["__scopeId","data-v-5f54fdd5"]]);export{M as default};
