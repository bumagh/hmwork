import{b as e,s as t,d as a,w as s,i as o,o as l,e as c,f as n,h as r,j as i,x as u,t as d,m,k as y,F as f,l as g,q as _,p,I as h}from"./index-BJtJjslE.js";import{c as C,e as F,b as k,g as x,_ as b}from"./_plugin-vue_export-helper.CmGny4PI.js";const v=b({name:"CategoryPage",data:()=>({currentMonth:"",totalIncome:0,totalExpense:0,balance:0,expenseCategories:[],incomeCategories:[],customCategories:[],showCategoryForm:!1,isEditMode:!1,categoryForm:{id:null,name:"",type:"expense",icon:"ðŸ“Œ",color:"#6FCF97"},iconOptions:["ðŸ“Œ","ðŸœ","ðŸš—","ðŸ›ï¸","ðŸŽ®","ðŸ’Š","ðŸ’°","ðŸ’¼","ðŸ“ˆ","ðŸ’µ","ðŸ ","âœˆï¸","ðŸ“±","ðŸŽ¬","ðŸ“š"],colorOptions:["#6FCF97","#F2994A","#BB6BD9","#56CCF2","#EB5757","#27AE60","#2D9CDB","#828282"]}),mounted(){this.currentMonth=x(),this.loadStatistics(),this.loadCustomCategories()},methods:{loadStatistics(){const[t,a]=this.currentMonth.split("-").map(Number),{startDate:s,endDate:o}=F(t,a);k.getStatistics(s,o).then(e=>{var t,a,s;e.success&&e.data&&(this.totalIncome=(null==(t=e.data.summary)?void 0:t.totalIncome)||0,this.totalExpense=(null==(a=e.data.summary)?void 0:a.totalExpense)||0,this.balance=(null==(s=e.data.summary)?void 0:s.balance)||0,this.expenseCategories=e.data.expense||[],this.incomeCategories=e.data.income||[])}).catch(t=>{console.error("åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:",t),e({title:"åŠ è½½å¤±è´¥",icon:"none"})})},loadCustomCategories(){C.getAll().then(e=>{e.success&&e.data&&(this.customCategories=e.data.filter(e=>1===e.is_custom))}).catch(e=>{console.error("åŠ è½½è‡ªå®šä¹‰åˆ†ç±»å¤±è´¥:",e)})},onMonthChange(e){this.currentMonth=e.detail.value,this.loadStatistics()},showAddCategoryForm(){this.isEditMode=!1,this.categoryForm={id:null,name:"",type:"expense",icon:"ðŸ“Œ",color:"#6FCF97"},this.showCategoryForm=!0},editCategory(e){this.isEditMode=!0,this.categoryForm={id:e.id,name:e.name,type:e.type,icon:e.icon||"ðŸ“Œ",color:e.color||"#6FCF97"},this.showCategoryForm=!0},deleteCategory(a){t({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤åˆ†ç±»"${a.name}"å—ï¼Ÿ`,success:t=>{t.confirm&&C.delete(a.id).then(t=>{t.success?(e({title:"åˆ é™¤æˆåŠŸ",icon:"success"}),this.loadCustomCategories(),this.loadStatistics()):e({title:t.message||"åˆ é™¤å¤±è´¥",icon:"none"})}).catch(t=>{console.error("åˆ é™¤åˆ†ç±»å¤±è´¥:",t),e({title:"åˆ é™¤å¤±è´¥",icon:"none"})})}})},onNameInput(e){this.categoryForm.name=e.detail.value},selectCategoryType(e){this.categoryForm.type=e},selectIcon(e){this.categoryForm.icon=e},selectColor(e){this.categoryForm.color=e},handleOverlayClick(){this.closeCategoryForm()},closeCategoryForm(){this.showCategoryForm=!1},submitCategoryForm(){if(!this.categoryForm.name.trim())return void e({title:"è¯·è¾“å…¥åˆ†ç±»åç§°",icon:"none"});const t={name:this.categoryForm.name.trim(),type:this.categoryForm.type,icon:this.categoryForm.icon,color:this.categoryForm.color};(this.isEditMode?C.update(this.categoryForm.id,t):C.create(t)).then(t=>{t.success?(e({title:this.isEditMode?"æ›´æ–°æˆåŠŸ":"æ·»åŠ æˆåŠŸ",icon:"success"}),this.closeCategoryForm(),this.loadCustomCategories(),this.loadStatistics()):e({title:t.message||"æ“ä½œå¤±è´¥",icon:"none"})}).catch(t=>{console.error("æäº¤å¤±è´¥:",t),e({title:"æ“ä½œå¤±è´¥",icon:"none"})})}}},[["render",function(e,t,C,F,k,x){const b=r,v=o,E=u,I=h;return l(),a(v,{class:"category-page"},{default:s(()=>[c(v,{class:"page-header"},{default:s(()=>[c(b,{class:"page-title"},{default:s(()=>[i("åˆ†ç±»ç»Ÿè®¡")]),_:1}),c(v,{class:"month-selector"},{default:s(()=>[c(E,{mode:"date",fields:"month",value:k.currentMonth,onChange:x.onMonthChange},{default:s(()=>[c(v,{class:"month-display"},{default:s(()=>[c(b,null,{default:s(()=>[i(d(k.currentMonth),1)]),_:1}),c(b,{class:"arrow"},{default:s(()=>[i("â–¼")]),_:1})]),_:1})]),_:1},8,["value","onChange"])]),_:1})]),_:1}),c(v,{class:"statistics-summary"},{default:s(()=>[c(v,{class:"summary-item"},{default:s(()=>[c(b,{class:"summary-label"},{default:s(()=>[i("æ€»æ”¶å…¥")]),_:1}),c(b,{class:"summary-value income"},{default:s(()=>[i("Â¥"+d(k.totalIncome.toFixed(2)),1)]),_:1})]),_:1}),c(v,{class:"summary-item"},{default:s(()=>[c(b,{class:"summary-label"},{default:s(()=>[i("æ€»æ”¯å‡º")]),_:1}),c(b,{class:"summary-value expense"},{default:s(()=>[i("Â¥"+d(k.totalExpense.toFixed(2)),1)]),_:1})]),_:1}),c(v,{class:"summary-item"},{default:s(()=>[c(b,{class:"summary-label"},{default:s(()=>[i("ç»“ä½™")]),_:1}),c(b,{class:m(["summary-value balance",{negative:k.balance<0}])},{default:s(()=>[i(" Â¥"+d(k.balance.toFixed(2)),1)]),_:1},8,["class"])]),_:1})]),_:1}),c(v,{class:"category-sections"},{default:s(()=>[c(v,{class:"category-section"},{default:s(()=>[c(v,{class:"section-header"},{default:s(()=>[c(b,{class:"section-title"},{default:s(()=>[i("æ”¯å‡ºåˆ†ç±»")]),_:1})]),_:1}),c(v,{class:"category-list"},{default:s(()=>[(l(!0),y(f,null,g(k.expenseCategories,e=>(l(),a(v,{class:"category-card",key:e.id},{default:s(()=>[c(v,{class:"category-icon-wrapper",style:_({backgroundColor:e.color})},{default:s(()=>[c(b,{class:"category-icon"},{default:s(()=>[i(d(e.icon),1)]),_:2},1024)]),_:2},1032,["style"]),c(v,{class:"category-info"},{default:s(()=>[c(b,{class:"category-name"},{default:s(()=>[i(d(e.name),1)]),_:2},1024),c(b,{class:"category-count"},{default:s(()=>[i(d(e.transaction_count)+" ç¬”",1)]),_:2},1024)]),_:2},1024),c(v,{class:"category-amount-wrapper"},{default:s(()=>[c(b,{class:"category-amount"},{default:s(()=>[i("Â¥"+d(e.total_amount.toFixed(2)),1)]),_:2},1024),k.totalExpense>0?(l(),a(b,{key:0,class:"category-percent"},{default:s(()=>[i(d((e.total_amount/k.totalExpense*100).toFixed(1))+"% ",1)]),_:2},1024)):n("",!0)]),_:2},1024)]),_:2},1024))),128)),0===k.expenseCategories.length?(l(),a(v,{key:0,class:"empty-state"},{default:s(()=>[c(b,{class:"empty-text"},{default:s(()=>[i("æš‚æ— æ”¯å‡ºè®°å½•")]),_:1})]),_:1})):n("",!0)]),_:1})]),_:1}),c(v,{class:"category-section"},{default:s(()=>[c(v,{class:"section-header"},{default:s(()=>[c(b,{class:"section-title"},{default:s(()=>[i("æ”¶å…¥åˆ†ç±»")]),_:1})]),_:1}),c(v,{class:"category-list"},{default:s(()=>[(l(!0),y(f,null,g(k.incomeCategories,e=>(l(),a(v,{class:"category-card",key:e.id},{default:s(()=>[c(v,{class:"category-icon-wrapper",style:_({backgroundColor:e.color})},{default:s(()=>[c(b,{class:"category-icon"},{default:s(()=>[i(d(e.icon),1)]),_:2},1024)]),_:2},1032,["style"]),c(v,{class:"category-info"},{default:s(()=>[c(b,{class:"category-name"},{default:s(()=>[i(d(e.name),1)]),_:2},1024),c(b,{class:"category-count"},{default:s(()=>[i(d(e.transaction_count)+" ç¬”",1)]),_:2},1024)]),_:2},1024),c(v,{class:"category-amount-wrapper"},{default:s(()=>[c(b,{class:"category-amount"},{default:s(()=>[i("Â¥"+d(e.total_amount.toFixed(2)),1)]),_:2},1024),k.totalIncome>0?(l(),a(b,{key:0,class:"category-percent"},{default:s(()=>[i(d((e.total_amount/k.totalIncome*100).toFixed(1))+"% ",1)]),_:2},1024)):n("",!0)]),_:2},1024)]),_:2},1024))),128)),0===k.incomeCategories.length?(l(),a(v,{key:0,class:"empty-state"},{default:s(()=>[c(b,{class:"empty-text"},{default:s(()=>[i("æš‚æ— æ”¶å…¥è®°å½•")]),_:1})]),_:1})):n("",!0)]),_:1})]),_:1})]),_:1}),c(v,{class:"custom-category-section"},{default:s(()=>[c(v,{class:"section-header"},{default:s(()=>[c(b,{class:"section-title"},{default:s(()=>[i("è‡ªå®šä¹‰åˆ†ç±»")]),_:1}),c(v,{class:"add-category-btn",onClick:x.showAddCategoryForm},{default:s(()=>[c(b,{class:"add-icon"},{default:s(()=>[i("+")]),_:1})]),_:1},8,["onClick"])]),_:1}),c(v,{class:"custom-category-list"},{default:s(()=>[(l(!0),y(f,null,g(k.customCategories,e=>(l(),a(v,{class:"custom-category-item",key:e.id},{default:s(()=>[c(b,{class:"custom-icon"},{default:s(()=>[i(d(e.icon),1)]),_:2},1024),c(b,{class:"custom-name"},{default:s(()=>[i(d(e.name),1)]),_:2},1024),c(b,{class:"custom-type"},{default:s(()=>[i(d("income"===e.type?"æ”¶å…¥":"æ”¯å‡º"),1)]),_:2},1024),c(v,{class:"custom-actions"},{default:s(()=>[c(v,{class:"action-btn edit",onClick:t=>x.editCategory(e)},{default:s(()=>[i("ç¼–è¾‘")]),_:2},1032,["onClick"]),c(v,{class:"action-btn delete",onClick:t=>x.deleteCategory(e)},{default:s(()=>[i("åˆ é™¤")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),0===k.customCategories.length?(l(),a(v,{key:0,class:"empty-state"},{default:s(()=>[c(b,{class:"empty-text"},{default:s(()=>[i("æš‚æ— è‡ªå®šä¹‰åˆ†ç±»")]),_:1})]),_:1})):n("",!0)]),_:1})]),_:1}),k.showCategoryForm?(l(),a(v,{key:0,class:"category-form-overlay",onClick:x.handleOverlayClick},{default:s(()=>[c(v,{class:"category-form-container",onClick:t[2]||(t[2]=p(()=>{},["stop"]))},{default:s(()=>[c(v,{class:"form-header"},{default:s(()=>[c(b,{class:"form-title"},{default:s(()=>[i(d(k.isEditMode?"ç¼–è¾‘åˆ†ç±»":"æ–°å¢žåˆ†ç±»"),1)]),_:1}),c(v,{class:"close-btn",onClick:x.closeCategoryForm},{default:s(()=>[i("âœ•")]),_:1},8,["onClick"])]),_:1}),c(v,{class:"form-content"},{default:s(()=>[c(v,{class:"form-group"},{default:s(()=>[c(b,{class:"form-label"},{default:s(()=>[i("åˆ†ç±»åç§°")]),_:1}),c(I,{class:"form-input",type:"text",value:k.categoryForm.name,onInput:x.onNameInput,placeholder:"è¯·è¾“å…¥åˆ†ç±»åç§°"},null,8,["value","onInput"])]),_:1}),c(v,{class:"form-group"},{default:s(()=>[c(b,{class:"form-label"},{default:s(()=>[i("åˆ†ç±»ç±»åž‹")]),_:1}),c(v,{class:"type-selector"},{default:s(()=>[c(v,{class:m(["type-option",{active:"expense"===k.categoryForm.type}]),onClick:t[0]||(t[0]=e=>x.selectCategoryType("expense"))},{default:s(()=>[c(b,{class:"type-text"},{default:s(()=>[i("æ”¯å‡º")]),_:1})]),_:1},8,["class"]),c(v,{class:m(["type-option",{active:"income"===k.categoryForm.type}]),onClick:t[1]||(t[1]=e=>x.selectCategoryType("income"))},{default:s(()=>[c(b,{class:"type-text"},{default:s(()=>[i("æ”¶å…¥")]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}),c(v,{class:"form-group"},{default:s(()=>[c(b,{class:"form-label"},{default:s(()=>[i("å›¾æ ‡")]),_:1}),c(v,{class:"icon-selector"},{default:s(()=>[(l(!0),y(f,null,g(k.iconOptions,e=>(l(),a(v,{class:m(["icon-option",{selected:k.categoryForm.icon===e}]),key:e,onClick:t=>x.selectIcon(e)},{default:s(()=>[c(b,{class:"icon-text"},{default:s(()=>[i(d(e),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),c(v,{class:"form-group"},{default:s(()=>[c(b,{class:"form-label"},{default:s(()=>[i("é¢œè‰²")]),_:1}),c(v,{class:"color-selector"},{default:s(()=>[(l(!0),y(f,null,g(k.colorOptions,e=>(l(),a(v,{class:m(["color-option",{selected:k.categoryForm.color===e}]),key:e,style:_({backgroundColor:e}),onClick:t=>x.selectColor(e)},null,8,["class","style","onClick"]))),128))]),_:1})]),_:1})]),_:1}),c(v,{class:"form-actions"},{default:s(()=>[c(v,{class:"btn btn-cancel",onClick:x.closeCategoryForm},{default:s(()=>[i("å–æ¶ˆ")]),_:1},8,["onClick"]),c(v,{class:"btn btn-submit",onClick:x.submitCategoryForm},{default:s(()=>[i("ç¡®å®š")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])):n("",!0)]),_:1})}],["__scopeId","data-v-76501894"]]);export{v as default};
