import{b as e,s as t,d as s,w as a,i as l,o as i,e as o,f as d,h as r,j as n,x as c,t as u,S as f,k as h,F as m,l as _,m as k,p,I as g,y}from"./index-BJtJjslE.js";import{t as v,u as C,p as x,_ as b}from"./_plugin-vue_export-helper.CmGny4PI.js";const j=b({name:"TasksPage",data:()=>({tasks:[],projects:[],users:[],showTaskModal:!1,isEditMode:!1,taskForm:{id:null,name:"",description:"",project_id:null,assigned_to:null,status:"pending",priority:"medium",due_date:""},selectedProjectIndex:0,selectedUserIndex:0,selectedStatusIndex:0,selectedPriorityIndex:0,statusOptions:["å…¨éƒ¨çŠ¶æ€","å¾…å¤„ç†","è¿›è¡Œä¸­","å·²å®Œæˆ","å·²å–æ¶ˆ"],priorityOptions:["å…¨éƒ¨ä¼˜å…ˆçº§","ä½Ž","ä¸­","é«˜","ç´§æ€¥"],taskStatusOptions:[{label:"å¾…å¤„ç†",value:"pending"},{label:"è¿›è¡Œä¸­",value:"in_progress"},{label:"å·²å®Œæˆ",value:"completed"},{label:"å·²å–æ¶ˆ",value:"cancelled"}],taskPriorityOptions:[{label:"ä½Ž",value:"low"},{label:"ä¸­",value:"medium"},{label:"é«˜",value:"high"},{label:"ç´§æ€¥",value:"urgent"}],filterStatus:"",filterPriority:"",isLoading:!1}),computed:{filteredTasks(){return this.tasks.filter(e=>{const t=!this.filterStatus||e.status===this.filterStatus,s=!this.filterPriority||e.priority===this.filterPriority;return t&&s})}},mounted(){this.loadData()},methods:{loadData(){this.loadTasks(),this.loadProjects(),this.loadUsers()},loadTasks(){v.getAll().then(e=>{e.success&&e.data&&(this.tasks=e.data)}).catch(t=>{console.error("åŠ è½½ä»»åŠ¡åˆ—è¡¨å¤±è´¥:",t),e({title:"åŠ è½½å¤±è´¥",icon:"none"})})},loadProjects(){x.getAll().then(e=>{e.success&&e.data&&(this.projects=e.data)}).catch(e=>{console.error("åŠ è½½é¡¹ç›®åˆ—è¡¨å¤±è´¥:",e)})},loadUsers(){C.getAll().then(e=>{e.success&&e.data&&(this.users=e.data)}).catch(e=>{console.error("åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥:",e)})},onStatusChange(e){this.selectedStatusIndex=e.detail.value;this.filterStatus={0:"",1:"pending",2:"in_progress",3:"completed",4:"cancelled"}[this.selectedStatusIndex]},onPriorityChange(e){this.selectedPriorityIndex=e.detail.value;this.filterPriority={0:"",1:"low",2:"medium",3:"high",4:"urgent"}[this.selectedPriorityIndex]},showCreateTaskModal(){this.isEditMode=!1,this.taskForm={id:null,name:"",description:"",project_id:null,assigned_to:null,status:"pending",priority:"medium",due_date:""},this.selectedProjectIndex=0,this.selectedUserIndex=0,this.showTaskModal=!0},editTask(e){this.isEditMode=!0,this.taskForm={id:e.id||null,name:e.name,description:e.description||"",project_id:e.project_id,assigned_to:e.assigned_to,status:e.status,priority:e.priority,due_date:e.due_date||""},this.selectedProjectIndex=this.projects.findIndex(t=>t.id===e.project_id),this.selectedUserIndex=this.users.findIndex(t=>t.id===e.assigned_to),-1===this.selectedProjectIndex&&(this.selectedProjectIndex=0),-1===this.selectedUserIndex&&(this.selectedUserIndex=0),this.showTaskModal=!0},deleteTask(s){t({title:"ç¡®è®¤åˆ é™¤",content:`ç¡®å®šè¦åˆ é™¤ä»»åŠ¡"${s.name}"å—ï¼Ÿ`,success:t=>{t.confirm&&s.id&&v.delete(s.id).then(t=>{t.success?(e({title:"åˆ é™¤æˆåŠŸ",icon:"success"}),this.loadTasks()):e({title:t.message||"åˆ é™¤å¤±è´¥",icon:"none"})}).catch(t=>{console.error("åˆ é™¤ä»»åŠ¡å¤±è´¥:",t),e({title:"åˆ é™¤å¤±è´¥",icon:"none"})})}})},viewTaskDetail(e){console.log("æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…:",e)},onProjectChange(e){var t;this.selectedProjectIndex=e.detail.value,this.taskForm.project_id=(null==(t=this.projects[this.selectedProjectIndex])?void 0:t.id)||null},onUserChange(e){var t;this.selectedUserIndex=e.detail.value,this.taskForm.assigned_to=(null==(t=this.users[this.selectedUserIndex])?void 0:t.id)||null},selectStatus(e){this.taskForm.status=e},selectPriority(e){this.taskForm.priority=e},onDueDateChange(e){this.taskForm.due_date=e.detail.value},handleModalOverlayClick(){this.closeTaskModal()},closeTaskModal(){this.showTaskModal=!1},submitTaskForm(){if(!this.taskForm.name.trim())return void e({title:"è¯·è¾“å…¥ä»»åŠ¡åç§°",icon:"none"});if(!this.taskForm.project_id)return void e({title:"è¯·é€‰æ‹©æ‰€å±žé¡¹ç›®",icon:"none"});if(!this.taskForm.assigned_to)return void e({title:"è¯·é€‰æ‹©åˆ†é…äººå‘˜",icon:"none"});this.isLoading=!0;const t={name:this.taskForm.name.trim(),description:this.taskForm.description.trim(),project_id:this.taskForm.project_id,assigned_to:this.taskForm.assigned_to,status:this.taskForm.status,priority:this.taskForm.priority,due_date:this.taskForm.due_date||void 0};(this.isEditMode&&this.taskForm.id?v.update(this.taskForm.id,t):v.create(t)).then(t=>{this.isLoading=!1,t.success?(e({title:this.isEditMode?"æ›´æ–°æˆåŠŸ":"åˆ›å»ºæˆåŠŸ",icon:"success"}),this.closeTaskModal(),this.loadTasks()):e({title:t.message||"æ“ä½œå¤±è´¥",icon:"none"})}).catch(t=>{this.isLoading=!1,console.error("æäº¤ä»»åŠ¡å¤±è´¥:",t),e({title:"æ“ä½œå¤±è´¥",icon:"none"})})},getStatusLabel:e=>({pending:"å¾…å¤„ç†",in_progress:"è¿›è¡Œä¸­",completed:"å·²å®Œæˆ",cancelled:"å·²å–æ¶ˆ"}[e]||e),getStatusClass:e=>`status-${e}`,getPriorityLabel:e=>({low:"ä½Ž",medium:"ä¸­",high:"é«˜",urgent:"ç´§æ€¥"}[e]||e),getPriorityClass:e=>`priority-${e}`}},[["render",function(e,t,v,C,x,b){const j=r,P=l,I=c,F=f,T=g,M=y;return i(),s(P,{class:"tasks-page"},{default:a(()=>[o(P,{class:"page-header"},{default:a(()=>[o(j,{class:"page-title"},{default:a(()=>[n("ä»»åŠ¡ç®¡ç†")]),_:1}),o(P,{class:"header-actions"},{default:a(()=>[o(P,{class:"action-button",onClick:b.showCreateTaskModal},{default:a(()=>[o(j,{class:"action-icon"},{default:a(()=>[n("+")]),_:1}),o(j,{class:"action-text"},{default:a(()=>[n("æ–°å»ºä»»åŠ¡")]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1}),o(P,{class:"filter-section"},{default:a(()=>[o(P,{class:"filter-item"},{default:a(()=>[o(I,{range:x.statusOptions,value:x.selectedStatusIndex,onChange:b.onStatusChange},{default:a(()=>[o(P,{class:"picker-input"},{default:a(()=>[o(j,null,{default:a(()=>[n(u(x.statusOptions[x.selectedStatusIndex]),1)]),_:1}),o(j,{class:"arrow"},{default:a(()=>[n("â–¼")]),_:1})]),_:1})]),_:1},8,["range","value","onChange"])]),_:1}),o(P,{class:"filter-item"},{default:a(()=>[o(I,{range:x.priorityOptions,value:x.selectedPriorityIndex,onChange:b.onPriorityChange},{default:a(()=>[o(P,{class:"picker-input"},{default:a(()=>[o(j,null,{default:a(()=>[n(u(x.priorityOptions[x.selectedPriorityIndex]),1)]),_:1}),o(j,{class:"arrow"},{default:a(()=>[n("â–¼")]),_:1})]),_:1})]),_:1},8,["range","value","onChange"])]),_:1})]),_:1}),o(F,{class:"tasks-list","scroll-y":""},{default:a(()=>[(i(!0),h(m,null,_(b.filteredTasks,e=>(i(),s(P,{class:"task-card",key:e.id,onClick:t=>b.viewTaskDetail(e)},{default:a(()=>[o(P,{class:"task-header"},{default:a(()=>[o(P,{class:"task-info"},{default:a(()=>[o(j,{class:"task-name"},{default:a(()=>[n(u(e.name),1)]),_:2},1024),o(j,{class:"project-name"},{default:a(()=>[n(u(e.project_name||"æœªå…³è”é¡¹ç›®"),1)]),_:2},1024)]),_:2},1024),o(P,{class:k(["task-priority",b.getPriorityClass(e.priority)])},{default:a(()=>[n(u(b.getPriorityLabel(e.priority)),1)]),_:2},1032,["class"])]),_:2},1024),o(P,{class:"task-body"},{default:a(()=>[o(j,{class:"task-description"},{default:a(()=>[n(u(e.description||"æš‚æ— æè¿°"),1)]),_:2},1024)]),_:2},1024),o(P,{class:"task-footer"},{default:a(()=>[o(P,{class:"task-meta"},{default:a(()=>[o(j,{class:"meta-item"},{default:a(()=>[n("ðŸ‘¤ "+u(e.assigned_user_name||"æœªåˆ†é…"),1)]),_:2},1024),e.due_date?(i(),s(j,{key:0,class:"meta-item"},{default:a(()=>[n("ðŸ“… "+u(e.due_date),1)]),_:2},1024)):d("",!0)]),_:2},1024),o(P,{class:k(["task-status",b.getStatusClass(e.status)])},{default:a(()=>[n(u(b.getStatusLabel(e.status)),1)]),_:2},1032,["class"])]),_:2},1024),o(P,{class:"task-actions"},{default:a(()=>[o(P,{class:"action-btn edit",onClick:p(t=>b.editTask(e),["stop"])},{default:a(()=>[n("ç¼–è¾‘")]),_:2},1032,["onClick"]),o(P,{class:"action-btn delete",onClick:p(t=>b.deleteTask(e),["stop"])},{default:a(()=>[n("åˆ é™¤")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["onClick"]))),128)),0===b.filteredTasks.length?(i(),s(P,{key:0,class:"empty-state"},{default:a(()=>[o(j,{class:"empty-icon"},{default:a(()=>[n("ðŸ“‹")]),_:1}),o(j,{class:"empty-text"},{default:a(()=>[n("æš‚æ— ä»»åŠ¡")]),_:1}),o(j,{class:"empty-tip"},{default:a(()=>[n("ç‚¹å‡»å³ä¸Šè§’æŒ‰é’®åˆ›å»ºæ–°ä»»åŠ¡")]),_:1})]),_:1})):d("",!0)]),_:1}),x.showTaskModal?(i(),s(P,{key:0,class:"task-modal-overlay",onClick:b.handleModalOverlayClick},{default:a(()=>[o(P,{class:"task-modal-container",onClick:t[2]||(t[2]=p(()=>{},["stop"]))},{default:a(()=>[o(P,{class:"modal-header"},{default:a(()=>[o(j,{class:"modal-title"},{default:a(()=>[n(u(x.isEditMode?"ç¼–è¾‘ä»»åŠ¡":"æ–°å»ºä»»åŠ¡"),1)]),_:1}),o(P,{class:"close-btn",onClick:b.closeTaskModal},{default:a(()=>[n("âœ•")]),_:1},8,["onClick"])]),_:1}),o(P,{class:"modal-content"},{default:a(()=>[o(P,{class:"form-group"},{default:a(()=>[o(j,{class:"form-label"},{default:a(()=>[n("ä»»åŠ¡åç§°")]),_:1}),o(T,{class:"form-input",type:"text",modelValue:x.taskForm.name,"onUpdate:modelValue":t[0]||(t[0]=e=>x.taskForm.name=e),placeholder:"è¯·è¾“å…¥ä»»åŠ¡åç§°"},null,8,["modelValue"])]),_:1}),o(P,{class:"form-group"},{default:a(()=>[o(j,{class:"form-label"},{default:a(()=>[n("ä»»åŠ¡æè¿°")]),_:1}),o(M,{class:"form-textarea",modelValue:x.taskForm.description,"onUpdate:modelValue":t[1]||(t[1]=e=>x.taskForm.description=e),placeholder:"è¯·è¾“å…¥ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰",maxlength:"500"},null,8,["modelValue"])]),_:1}),o(P,{class:"form-group"},{default:a(()=>[o(j,{class:"form-label"},{default:a(()=>[n("æ‰€å±žé¡¹ç›®")]),_:1}),o(I,{range:x.projects,"range-key":"name",value:x.selectedProjectIndex,onChange:b.onProjectChange},{default:a(()=>[o(P,{class:"picker-input"},{default:a(()=>[o(j,null,{default:a(()=>{var e;return[n(u((null==(e=x.projects[x.selectedProjectIndex])?void 0:e.name)||"è¯·é€‰æ‹©é¡¹ç›®"),1)]}),_:1}),o(j,{class:"arrow"},{default:a(()=>[n("â–¼")]),_:1})]),_:1})]),_:1},8,["range","value","onChange"])]),_:1}),o(P,{class:"form-group"},{default:a(()=>[o(j,{class:"form-label"},{default:a(()=>[n("åˆ†é…ç»™")]),_:1}),o(I,{range:x.users,"range-key":"username",value:x.selectedUserIndex,onChange:b.onUserChange},{default:a(()=>[o(P,{class:"picker-input"},{default:a(()=>[o(j,null,{default:a(()=>{var e;return[n(u((null==(e=x.users[x.selectedUserIndex])?void 0:e.username)||"è¯·é€‰æ‹©äººå‘˜"),1)]}),_:1}),o(j,{class:"arrow"},{default:a(()=>[n("â–¼")]),_:1})]),_:1})]),_:1},8,["range","value","onChange"])]),_:1}),o(P,{class:"form-group"},{default:a(()=>[o(j,{class:"form-label"},{default:a(()=>[n("ä»»åŠ¡çŠ¶æ€")]),_:1}),o(P,{class:"status-selector"},{default:a(()=>[(i(!0),h(m,null,_(x.taskStatusOptions,(e,t)=>(i(),s(P,{class:k(["status-option",{active:x.taskForm.status===e.value}]),key:e.value,onClick:t=>b.selectStatus(e.value)},{default:a(()=>[o(j,{class:"status-text"},{default:a(()=>[n(u(e.label),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),o(P,{class:"form-group"},{default:a(()=>[o(j,{class:"form-label"},{default:a(()=>[n("ä¼˜å…ˆçº§")]),_:1}),o(P,{class:"priority-selector"},{default:a(()=>[(i(!0),h(m,null,_(x.taskPriorityOptions,(e,t)=>(i(),s(P,{class:k(["priority-option",{active:x.taskForm.priority===e.value}]),key:e.value,onClick:t=>b.selectPriority(e.value)},{default:a(()=>[o(j,{class:"priority-text"},{default:a(()=>[n(u(e.label),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),o(P,{class:"form-group"},{default:a(()=>[o(j,{class:"form-label"},{default:a(()=>[n("æˆªæ­¢æ—¥æœŸ")]),_:1}),o(I,{mode:"date",value:x.taskForm.due_date,onChange:b.onDueDateChange},{default:a(()=>[o(P,{class:"picker-input"},{default:a(()=>[o(j,null,{default:a(()=>[n(u(x.taskForm.due_date||"è¯·é€‰æ‹©æˆªæ­¢æ—¥æœŸ"),1)]),_:1}),o(j,{class:"arrow"},{default:a(()=>[n("â–¼")]),_:1})]),_:1})]),_:1},8,["value","onChange"])]),_:1})]),_:1}),o(P,{class:"modal-actions"},{default:a(()=>[o(P,{class:"btn btn-cancel",onClick:b.closeTaskModal},{default:a(()=>[n("å–æ¶ˆ")]),_:1},8,["onClick"]),o(P,{class:"btn btn-submit",onClick:b.submitTaskForm},{default:a(()=>[n("ç¡®å®š")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onClick"])):d("",!0)]),_:1})}],["__scopeId","data-v-6dc858c2"]]);export{j as default};
